# Section 6: Data Mapping and Schema – Diagrams

This file defines the visuals needed to illustrate how data mapping, canonical modeling, and schema transformation are handled in Section 6. The diagrams emphasize insulation from regulator changes, master data alignment, and error-proof mapping.

---

## Diagram 15: Canonical Schema Model

### Intent
Show how diverse ERP field structures map into a unified canonical schema, which is then transformed into the FIRS-required format. Demonstrate insulation from regulator changes and reduced ERP disruption.

### Canvas Layout
Left to right flow: ERP Systems → Canonical Schema → FIRS Schema.

### Elements to Show
- **ERP Inputs (Left Column):**
  - SAP ECC IDoc segments: E1EDK01 (header), E1EDP01 (line items).
  - SAP S4/HANA entities: Billing Document API fields.
  - Oracle EBS: XML invoice node set.
  - Dynamics: OData/CSV fields.
  - Legacy ERPs: CSV/Flat file.

- **Middle Layer:**
  - Box labeled **Bluelight SmartAPI Canonical Schema**.
  - Inside: grouped fields
    - Header: invoice number, supplier TIN, buyer TIN, date, totals.
    - Line Items: line no, description, qty, unit price, tax code.
    - Taxation: VAT codes, exemptions, zero-rated.
    - References: order no, delivery note, customer ID.
    - Metadata: correlation ID, ERP system ID.
  - Caption: *Stable, versioned model insulating ERP from regulator churn.*

- **Right Column:**
  - Box labeled **FIRS MBS Schema (UBL/XML or JSON)**.
  - Arrow labeled *Transformation & Validation* from Canonical Schema → FIRS Schema.
  - Output: Submission to FIRS with IRN/QR receipts.

- **Notes:**
  - Callout bubble: “ERP fields mapped once into canonical, regulator changes absorbed in SmartAPI layer.”
  - Highlight version control and backward compatibility.

---

## Diagram 16: Reference Library Architecture

### Intent
Illustrate how SmartAPI maintains synchronized reference libraries (HS codes, TINs, tax codes, service codes) to ensure invoice mapping accuracy and reduce rejections.

### Canvas Layout
Central SmartAPI Reference Library box connected to Client Master Data on one side and FIRS Resources on the other.

### Elements to Show
- **Client Side Inputs (Left):**
  - Customer Master Data table (client IDs, names, TINs).
  - Product Master Data table (product IDs, descriptions, HS codes).
  - ERP Tax Code configuration.

- **Middle Layer:**
  - Box labeled **Bluelight SmartAPI Reference Library**.
  - Inside, four sub-boxes:
    - Customer-TIN mapping.
    - Product-HS code mapping.
    - Tax code mapping.
    - Service code library.
  - Caption: *Validated and cached centrally.*

- **Right Side:**
  - Box labeled **FIRS Reference Data Services**.
  - Arrow labeled “Sync & Refresh” connecting to SmartAPI Reference Library.
  - Sub-caption: *Automatic updates, client overrides possible.*

- **Flows:**
  - Client → SmartAPI → FIRS (validation).
  - SmartAPI validates invoice data against reference libraries before submission.

- **Notes:**
  - Callout bubble: “Ensures Buyer TIN, HS code, and Tax code correctness before FIRS submission.”
  - Error prevention note: “Bad data caught early → fewer rejections.”

---

### Style Guidance
- Consistent swimlane or layered approach: Client (left), SmartAPI (center), Regulator (right).
- Use table/grid icons for master data and libraries.
- Shield/check icons on validation arrows.
- Green arrows for successful flows, red callouts for rejected invalid data.
